{
  "hash": "648dd10cbee3038262eb73ea65c3ae8f",
  "result": {
    "markdown": "---\ntitle: \"EC50\"\nauthor: \"Yuri\"\nformat: html\n---\n\n::: {.cell hash='aula17_cache/html/unnamed-chunk-1_ce39ab2373e0b11a52181aab565aaebb'}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(remotes)\n\ndat <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/15pCj0zljvd-TGECe67OMt6sa21xO8BqUgv4d-kU8qi8/edit#gid=0\")\n\noptions(scipen=999)\ndat2 <- dat |> \n  dplyr::select(-Isolate, Population) |> \n  group_by(Code, Year, Dose) |> \n  summarise(GC_mean = mean(GC))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Code', 'Year'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nFGT152 <- dat2 |> \n  filter(Code == \"FGT152\")\n\nFGT152 |> \n  ggplot(aes(factor(Dose), GC_mean))+\n  geom_point()+\n  geom_line()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n```\n:::\n\n::: {.cell-output-display}\n![](aula17_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndat2 |> \n   ggplot(aes(factor(Dose), GC_mean))+\n  geom_point()+\n  geom_line()+\n  facet_wrap(~Code)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n```\n:::\n\n::: {.cell-output-display}\n![](aula17_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n:::\n\n\nPACOTE DRC PARA EC50:\n\n\n::: {.cell hash='aula17_cache/html/unnamed-chunk-2_db72aee50f4180f58e328e78d33d8f16'}\n\n```{.r .cell-code}\nlibrary(drc)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: MASS\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'MASS'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n'drc' has been loaded.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPlease cite R and 'drc' if used for a publication,\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nfor references type 'citation()' and 'citation('drc')'.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'drc'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    gaussian, getInitial\n```\n:::\n\n```{.r .cell-code}\ndrc1 <- drm(GC_mean ~ Dose, data = FGT152,\n    fct = LL.3())\nAIC(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 33.60846\n```\n:::\n\n```{.r .cell-code}\nsummary(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value     p-value    \nb:(Intercept)  0.401905   0.053427  7.5225    0.001672 ** \nd:(Intercept) 47.540342   1.459890 32.5643 0.000005302 ***\ne:(Intercept)  7.220130   2.340119  3.0854    0.036739 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 1.993805 (4 degrees of freedom)\n```\n:::\n\n```{.r .cell-code}\nplot(drc1)\n```\n\n::: {.cell-output-display}\n![](aula17_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nED(drc1, 50, interval = \"delta\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nEstimated effective doses\n\n       Estimate Std. Error    Lower    Upper\ne:1:50  7.22013    2.34012  0.72292 13.71734\n```\n:::\n:::\n\n::: {.cell hash='aula17_cache/html/unnamed-chunk-3_6966d6f77c169171c1f25ab5ab69c9a1'}\n\n```{.r .cell-code}\nlibrary(ec50estimator)\n\ndf_ec50 <- estimate_EC50(GC_mean ~ Dose,\n                         data = dat2,\n                         isolate_col = \"Code\",\n                         interval = \"delta\",\n                         fct = drc::LL.3())\n\n\n## Função criada pelo Cha\n\ndf_ED50 <- function(formula, isolate_col, fct = LL.3(), ed_perc = 50, interval = \"delta\", data) {\n  # get the unique values of the isolate column\n  isolates <- unique(data %>% pull(isolate_col))\n\n  # apply drm() and ED() to each isolate\n  quiet_map <- quietly(map_df)\n  results <- quiet_map(\n    isolates, \n    ~{\n      # subset the data for the current isolate\n      isolate_data <- data %>% filter(!!sym(isolate_col) == .x)\n      \n      # apply drm()\n      drm_result <- drm(formula, data = isolate_data, fct = fct)\n      \n      # apply ED() and extract the EC50 value and its confidence interval\n      ed_result <- as.data.frame(ED(drm_result, ed_perc, interval = interval))\n      \n      # return as a data frame\n      tibble(\n        isolate = .x,\n        EC50 = ed_result[\"e:1:50\", \"Estimate\"],\n        lower = ed_result[\"e:1:50\", \"Lower\"],\n        upper = ed_result[\"e:1:50\", \"Upper\"]\n      )\n    }\n  )$result\n\n  return(results)\n}\n\nresults <- df_ED50(GC_mean ~ Dose, \n                   isolate_col = \"Code\", \n                   data = dat2)\n\n\n# print the results\nresults\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 4\n   isolate    EC50    lower  upper\n   <chr>     <dbl>    <dbl>  <dbl>\n 1 FGT152   7.22     0.723  13.7  \n 2 FGT169   0.577    0.0549  1.10 \n 3 FGT170   2.28     1.41    3.15 \n 4 FGT186   3.29    -1.15    7.72 \n 5 FGT187   0.0985  -0.0226  0.220\n 6 FGT189   9.30     2.29   16.3  \n 7 FGT201   4.93     0.172   9.68 \n 8 FGT202  13.8    -17.4    45.0  \n 9 FGT215   0.505    0.213   0.797\n10 FGT229   0.568   -0.241   1.38 \n11 FGT231   1.83     0.153   3.50 \n12 FGT232   0.340    0.105   0.575\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}